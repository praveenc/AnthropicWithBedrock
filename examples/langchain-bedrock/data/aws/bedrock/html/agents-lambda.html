<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Action group Lambda functions - Amazon Bedrock</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="agents-lambda" /><meta name="default_state" content="agents-lambda" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/bedrock/latest/userguide/agents-lambda.html" /><meta name="description" content="You can define a Lambda function to program the business logic for carrying out an action group and to customize how you want the API response to be returned. You use the variables from the input event to define your functions and return a response to the agent. To write your function, you will need to understand the format of the input event and expected response. If you use a Lambda function for your action group, you must attach a resource-based policy to your Lambda function by following the steps at" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Bedrock" /><meta name="guide" content="User Guide" /><meta name="abstract" content="User Guide for the Amazon Bedrock service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/bedrock/latest/userguide/agents-lambda.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/bedrock/latest/userguide/agents-lambda.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/bedrock/latest/userguide/agents-lambda.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/bedrock/latest/userguide/agents-lambda.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/bedrock/latest/userguide/agents-lambda.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/bedrock/latest/userguide/agents-lambda.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/bedrock/latest/userguide/agents-lambda.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/bedrock/latest/userguide/agents-lambda.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/bedrock/latest/userguide/agents-lambda.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/bedrock/latest/userguide/agents-lambda.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/bedrock/latest/userguide/agents-lambda.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/bedrock/latest/userguide/agents-lambda.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/bedrock/latest/userguide/agents-lambda.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/bedrock/latest/userguide/agents-lambda.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/bedrock/latest/userguide/agents-lambda.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/bedrock/latest/userguide/agents-lambda.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/bedrock/latest/userguide/agents-lambda.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/bedrock/latest/userguide/agents-lambda.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/bedrock/latest/userguide/agents-lambda.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/bedrock/latest/userguide/agents-lambda.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/bedrock/latest/userguide/agents-lambda.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/bedrock/latest/userguide/agents-lambda.html" hreflang="x-default" /><meta name="feedback-folder" content="2d8c2a09-1dac-41bf-9893-c0333d272b2c" /><meta name="feedback-item" content="Bedrock" /><meta name="this_doc_product" content="Amazon Bedrock" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'bedrock'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Action group Lambda functions" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Action group Lambda functions - Amazon Bedrock</title><meta name="pdf" content="/pdfs/bedrock/latest/userguide/bedrock-ug.pdf#agents-lambda" /><meta name="rss" content="bedrock-ug.rss" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?feedback_destination_id=2d8c2a09-1dac-41bf-9893-c0333d272b2c&amp;topic_url=http://docs.aws.amazon.com/en_us/bedrock/latest/userguide/agents-lambda.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/bedrock/latest/userguide/agents-lambda.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/bedrock/latest/userguide/agents-lambda.html" /><meta name="keywords" content="Amazon Bedrock,bedrock,chatbot,action groups,agent" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Bedrock",
        "item" : "https://docs.aws.amazon.com/bedrock/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/bedrock/latest/userguide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Agents for Amazon Bedrock",
        "item" : "https://docs.aws.amazon.com/bedrock/latest/userguide/agents.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Set up action groups for your agent",
        "item" : "https://docs.aws.amazon.com/bedrock/latest/userguide/agents-setup.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Action group Lambda functions",
        "item" : "https://docs.aws.amazon.com/bedrock/latest/userguide/agents-setup.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/bedrock/latest/userguide/bedrock-ug.pdf#agents-lambda" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/bedrock/index.html">Amazon Bedrock</a><a href="what-is-bedrock.html">User Guide</a></div><div id="page-toc-src"><a href="#agents-lambda-input">Lambda input event from Amazon Bedrock</a><a href="#agents-lambda-response">Lambda response event to Amazon Bedrock</a><a href="#agents-lambda-example">Action group Lambda function example</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="agents-lambda">Action group Lambda functions</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>You can define a Lambda function to program the business logic for carrying out an action group and to customize how you want the API response to be returned. You use the variables from the input event to define your functions and return a response to the agent. To write your function, you will need to understand the format of the input event and expected response. If you use a Lambda function for your action group, you must attach a resource-based policy to your Lambda function by following the steps at <a href="./agents-permissions.html#agents-permissions-lambda">Permissions to access your action group Lambda functions</a>. For more information about resource-based policies in Lambda, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/access-control-resource-based.html">Using resource-based policies for Lambda</a>).</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#agents-lambda-input">Lambda input event from Amazon Bedrock</a></li><li><a href="#agents-lambda-response">Lambda response event to Amazon Bedrock</a></li><li><a href="#agents-lambda-example">Action group Lambda function example</a></li></ul></div>
            <h2 id="agents-lambda-input">Lambda input event from Amazon Bedrock</h2>
            
            <p>When an action group using a Lambda function is invoked, Amazon Bedrock sends a Lambda input event of the following general format. You can define your Lambda function to use any of the input event fields to manipulate the business logic within the function to successfully carry out the action. For more information about Lambda functions, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-services.html#event-driven-invocation">Event-driven invocation</a> in the AWS Lambda documentation.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "messageVersion": "1.0",
    "agent": <span>{</span>
        "name": "string",
        "id": "string",
        "alias": "string",
        "version": "string"
    },
    "inputText": "string",
    "sessionId": "string",
    "actionGroup": "string",
    "apiPath": "string",
    "httpMethod": "string",
    "parameters": [
        <span>{</span>
            "name": "string",
            "type": "string",
            "value": "string"
        },
    ...
    ],
    "requestBody": <span>{</span>
        "content": <span>{</span>
            "<code class="replaceable">&lt;content_type&gt;</code>": <span>{</span>
                "properties": [
                   <span>{</span>
                       "name": "string",
                       "type": "string",
                       "value": "string"
                    },
                            ...
                ]
            }
        }
    },
    "sessionAttributes": <span>{</span>
        "<code class="replaceable">string</code>": "string",
    },
    "promptSessionAttributes": <span>{</span>
        "<code class="replaceable">string</code>": "string"
    }
}</code></pre>
        
        <p>The input event fields are described below.</p>
            
        <div class="itemizedlist">
             
             
             
             
             
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><code class="code">messageVersion</code> â The version of the message that identifies the format of the event data going into the Lambda function and the expected format of the response from a Lambda function. Amazon Bedrock only supports version 1.0.</p>
            </li><li class="listitem">
                <p><code class="code">agent</code> â Contains information about the name, ID, alias, and version of the agent that the action group belongs to.</p>
            </li><li class="listitem">
                <p><code class="code">inputText</code> â The user input for the conversation turn.</p>
            </li><li class="listitem">
                <p><code class="code">sessionId</code> â The unique identifier of the agent session.</p>
            </li><li class="listitem">
                <p><code class="code">actionGroup</code> â The name of the action group.</p>
            </li><li class="listitem">
                <p><code class="code">apiPath</code> â The path to the API operation, as defined in the OpenAPI schema.</p>
            </li><li class="listitem">
                <p><code class="code">httpMethod</code> â The method of the API operation, as defined in the OpenAPI schema.</p>
            </li><li class="listitem">
                <p><code class="code">parameters</code> â Contains a list of objects. Each object contains the name, type, and value of a parameter in the API operation, as defined in the OpenAPI schema.</p>
            </li><li class="listitem">
                <p><code class="code">requestBody</code> â Contains the request body and its properties, as defined in the OpenAPI schema.</p>
            </li><li class="listitem">
                <p><code class="code">sessionAttributes</code> â Contains session attributes and their values.</p>
            </li><li class="listitem">
                <p><code class="code">promptSessionAttributes</code> â Contains prompt attributes and their values.</p>
            </li></ul></div>
            
         
            <h2 id="agents-lambda-response">Lambda response event to Amazon Bedrock</h2>
        
            <p>Amazon Bedrock expects a response from your Lambda function that matches the following format. The response consists of response parameters from the API after the action has been carried out. The agent can use the response from the Lambda function for further orchestration or to help it return a response to the customer.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "messageVersion": "1.0",
    "response": <span>{</span>
        "actionGroup": "string",
        "apiPath": "string",
        "httpMethod": "string",
        "httpStatusCode": number,
        "responseBody": <span>{</span>
            "<code class="replaceable">&lt;contentType&gt;</code>": <span>{</span>
                "body": "JSON-formatted string" 
            }
        },
        "sessionAttributes": <span>{</span>
            "<code class="replaceable">string</code>": "string",
        },
        "promptSessionAttributes": <span>{</span>
            "<code class="replaceable">string</code>": "string"
        }
    }
}</code></pre>
            
            <p>The response fields are described below. Note that <code class="code">sessionAttributes</code> and <code class="code">promptSessionAttributes</code> are optional.</p>
            
            <div class="itemizedlist">
                 
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p><code class="code">messageVersion</code> â The version of the message that identifies the format of the event data going into the Lambda function and the expected format of the response from a Lambda function. Amazon Bedrock only supports version 1.0.</p>
                </li><li class="listitem">
                    <p><code class="code">response</code> â Contains the following information about the API response.</p>
                    <div class="itemizedlist">
                         
                         
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p><code class="code">actionGroup</code> â The name of the action group.</p>
                        </li><li class="listitem">
                            <p><code class="code">apiPath</code> â The path to the API operation, as defined in the OpenAPI schema.</p>
                        </li><li class="listitem">
                            <p><code class="code">httpMethod</code> â The method of the API operation, as defined in the OpenAPI schema.</p>
                        </li><li class="listitem">
                            <p><code class="code">responseBody</code> â Contains the response body, as defined in the OpenAPI schema.</p>
                        </li></ul></div>
                </li><li class="listitem">
                    <p>(Optional) <code class="code">sessionAttributes</code> â Contains session attributes and their values.</p>
                </li><li class="listitem">
                    <p>(Optional) <code class="code">promptSessionAttributes</code> â Contains prompt attributes and their values.</p>
                </li></ul></div>
            
         
            <h2 id="agents-lambda-example">Action group Lambda function example</h2>
        
        <p>The following is an minimal example of how the Lambda function can be defined in Python.</p>
        
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">def lambda_handler(event, context):

    response_body = <span>{</span>
        'application/json': <span>{</span>
            'body': "<code class="replaceable">sample response</code>"
        }
    }
    
    action_response = <span>{</span>
        'actionGroup': event['actionGroup'],
        'apiPath': event['apiPath'],
        'httpMethod': event['httpMethod'],
        'httpStatusCode': 200,
        'responseBody': response_body
    }
    
    session_attributes = event['sessionAttributes']
    prompt_session_attributes = event['promptSessionAttributes']
    
    api_response = <span>{</span>
        'messageVersion': '1.0', 
        'response': action_response,
        'sessionAttributes': session_attributes,
        'promptSessionAttributes': prompt_session_attributes
    }
        
    return api_response</code></pre>
            
            
        
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./agents-api-schema.html">Action group OpenAPI schemas</div><div id="next" class="next-link" accesskey="n" href="./agents-create.html">Create an agent</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?feedback_destination_id=2d8c2a09-1dac-41bf-9893-c0333d272b2c&amp;topic_url=https://docs.aws.amazon.com/en_us/bedrock/latest/userguide/agents-lambda.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?feedback_destination_id=2d8c2a09-1dac-41bf-9893-c0333d272b2c&amp;topic_url=https://docs.aws.amazon.com/en_us/bedrock/latest/userguide/agents-lambda.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>